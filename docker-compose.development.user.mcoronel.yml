version: "3"
services:
  efem-dapp:
    build: ./dapp
    ports:
      - "3010:3010"
    environment:
      - REACT_APP_ENVIRONMENT=localhost
      - REACT_APP_NODE_ID=31
      - REACT_APP_NODE_CONNECTION_URL=https://public-node.testnet.rsk.co
      - REACT_APP_CROWDFUNDING_ADDRESS=0xf4876AC9F3B8e1a5fe77C1CDFa230e5ba414464c
      - REACT_APP_EXCHANGE_RATE_PROVIDER_ADDRESS=0xa7A3fb7702FaDE27c98FB6D6ABEEe5C0cdE882bF
      - REACT_APP_TOKEN_RIF_ADDRESS=0x19f64674d8a5b4e652319f5e239efd3bc969a1fe
      - REACT_APP_TOKEN_DOC_ADDRESS=0xCB46c0ddc60D18eFEB0E586C17Af6ea36452Dae0
      - REACT_APP_FEATHERJS_CONNECTION_URL=http://localhost:3030
      - REACT_APP_IPFS_PINNING_ENABLED=false
      - REACT_APP_IPFS_GATEWAY=http://localhost:8080/ipfs/

    volumes:
      - ./dapp/config/configuration.js:/usr/src/app/src/configuration.js
      - ${DAPP_PATH_SRC:-./dapp/app/src}:/usr/src/app/src
      - ${DAPP_PATH_ENV:-./dapp/app/.env}:/usr/src/app/.env
      - ${SMART_CONTRACT_PROJECT}:/usr/src/app/node_modules/@acdi/give4forests-crowdfunding-contract
     
  efem-feathers:
    build: ./feathers
    ports:
      - "3030:3030"
    volumes:
      - ./feathers/config/default.json:/usr/src/app/config/default.json
      - ${FEATHERS_PATH_SRC:-./feathers/src}:/usr/src/app/src
      - ${FEATHERS_PATH_ENV:-./feathers/.env}:/usr/src/app/.env

  efem-ipfs:
    build: 
      context: ./ipfs
    ports:
      - "4001:4001"     # Swarm tcp, should be exposed to the public
      - "4001:4001/udp" # Swarm tcp, should be exposed to the public
      - "5001:5001"     # Daemon API; must not be exposed publicly but to client services under you control
      - "8080:8080"     # Web Gateway
